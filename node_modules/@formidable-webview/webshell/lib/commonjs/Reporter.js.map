{"version":3,"sources":["Reporter.ts"],"names":["describe","template","args","reduce","buffer","currentSnippet","index","push","join","codes","WEBSH_MISSING_SHELL_HANDLER","code","verbose","identifier","eventId","WEBSH_FEAT_MISSING_WEB_HANDLER","WEBSH_FEAT_MISSING_IN_SHELL","WEBSH_SCRIPT_ERROR","body","WEBSH_WEBVIEW_MISSING_MEMBER","WEBSH_DUPLICATED_REGISTERED_PROP","originalSpec","duplicatingSpec","name","featureIdentifier","Reporter","webshellDebug","strict","message","Error","console","warn","severity","info"],"mappings":"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","sourcesContent":["import { PropDefinition } from './types';\n\nexport type ErrorCode =\n  | 'WEBSH_MISSING_SHELL_HANDLER'\n  | 'WEBSH_SCRIPT_ERROR'\n  | 'WEBSH_WEBVIEW_MISSING_MEMBER'\n  | 'WEBSH_FEAT_MISSING_WEB_HANDLER'\n  | 'WEBSH_FEAT_MISSING_IN_SHELL'\n  | 'WEBSH_DUPLICATED_REGISTERED_PROP';\n\nfunction describe(template: TemplateStringsArray, ...args: any[]) {\n  return (\n    '[Webshell]: ' +\n    template\n      .reduce((buffer, currentSnippet, index) => {\n        buffer.push(currentSnippet, args[index] || '');\n        return buffer;\n      }, [] as string[])\n      .join('')\n  );\n}\n\ninterface ErrorDefinition<E extends ErrorCode> {\n  code: E;\n  verbose: (...args: any[]) => string;\n}\n\nconst codes: Record<ErrorCode, ErrorDefinition<ErrorCode>> = {\n  WEBSH_MISSING_SHELL_HANDLER: {\n    code: 'WEBSH_MISSING_SHELL_HANDLER',\n    verbose: function (identifier, eventId) {\n      return describe`Web script from feature \"${identifier}\" sent an event for \"${eventId}\" shell handler, but there is no shell handler registered for this feature. Use FeatureBuilder.withShellHandler to register that handler, or make sure its name is not misspell in the DOM script.`;\n    }\n  },\n  WEBSH_FEAT_MISSING_WEB_HANDLER: {\n    code: 'WEBSH_FEAT_MISSING_WEB_HANDLER',\n    verbose: function (identifier, eventId) {\n      return describe`Feature \"${identifier}\" has no Web handler with ID \"${eventId}\".`;\n    }\n  },\n  WEBSH_FEAT_MISSING_IN_SHELL: {\n    code: 'WEBSH_FEAT_MISSING_IN_SHELL',\n    verbose: function (identifier) {\n      return describe`Feature ${identifier} has not be instantiated in this shell.`;\n    }\n  },\n  WEBSH_SCRIPT_ERROR: {\n    code: 'WEBSH_SCRIPT_ERROR',\n    verbose: function (identifier, body = 'empty error') {\n      return describe`Web script from feature \"${identifier}\" raised an error: ${body}`;\n    }\n  },\n  WEBSH_WEBVIEW_MISSING_MEMBER: {\n    code: 'WEBSH_WEBVIEW_MISSING_MEMBER',\n    verbose: function () {\n      return describe`The WebView element you passed is missing \"injectJavaScript\" method.`;\n    }\n  },\n  WEBSH_DUPLICATED_REGISTERED_PROP: {\n    code: 'WEBSH_DUPLICATED_REGISTERED_PROP',\n    verbose: function (\n      originalSpec: PropDefinition<any, any>,\n      duplicatingSpec: PropDefinition<any, any>\n    ) {\n      return describe`Prop \"${duplicatingSpec.name}\" from feature \"${duplicatingSpec.featureIdentifier}\" is in conflict with a prop of the same name from feature \"${originalSpec.featureIdentifier}\".`;\n    }\n  }\n};\n\nexport default class Reporter {\n  private readonly webshellDebug: boolean;\n  private readonly strict: boolean;\n  constructor(webshellDebug: boolean, strict: boolean) {\n    this.webshellDebug = webshellDebug;\n    this.strict = strict;\n  }\n  dispatchError(code: ErrorCode, ...args: any[]) {\n    if (!this.webshellDebug) {\n      return;\n    }\n    const message = codes[code].verbose(...args);\n    if (this.strict) {\n      throw new Error(message);\n    } else {\n      console.warn(message);\n    }\n  }\n\n  dispatchWebLog(\n    severity: 'warn' | 'info',\n    identifier: string,\n    message: string\n  ) {\n    if (!this.webshellDebug) {\n      return;\n    }\n    if (severity === 'warn') {\n      console.warn(`[Webshell(${identifier})]: ${message}`);\n    } else if (severity === 'info') {\n      console.info(`[Webshell(${identifier})]: ${message}`);\n    }\n  }\n}\n"]}